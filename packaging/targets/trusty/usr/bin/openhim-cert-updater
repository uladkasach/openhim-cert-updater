#!/bin/bash

echo "Starting openhim-cert-updater...";
source $HOME/.nvm/nvm.sh && nvm use 6.11

# Ensure openhim-cert-updater is installed
DIRECTORY="/usr/share/openhim-cert-updater"
CONFIGFILE="/usr/share/openhim-cert-updater/config/config.json"
if [ ! -d "$DIRECTORY" ]; then
    echo "openhim-cert-updater was not found at expected location ($DIRECTORY)."
    echo  "Are you sure its installed?"
    exit 1;
fi


if [[ "$1" == "--config" || "$1" == "-c" ]]; then
    echo "Starting configuration proces...";
    echo " ";

    if [[ "$2" == "--manual" || "$2" == "-m" ]]; then
        sudo nano "$CONFIGFILE";
    else
        cd "$DIRECTORY";
        node "setup_config.js";
    fi
else
    # Ensure config file was created
    if [ ! -f "$CONFIGFILE" ]; then
        echo "The configuration file (config.json) was not found at the expected location."
        echo "Are you sure it was created?"
        echo "See https://github.com/uladkasach/openhim-cert-updater for details."
        exit 1;
    fi

    echo "Successful installation detected. Starting updating proces...";

    cd "$DIRECTORY";
    node update_certificates.js "$@"; ## the $@ is used to pass all arguments through to script.
fi
